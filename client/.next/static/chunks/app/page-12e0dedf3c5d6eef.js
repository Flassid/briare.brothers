(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7285:function(e,t,a){Promise.resolve().then(a.bind(a,5959))},5959:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var n=a(7437),r=a(9997),s=a(2265),i=a(6933),l=a(9354),o=a(7055),c=a(5348);let d=[{rune:"ᚠ",x:5,duration:14},{rune:"ᚢ",x:15,duration:16},{rune:"ᚦ",x:25,duration:12},{rune:"ᚨ",x:35,duration:18},{rune:"ᚱ",x:45,duration:15},{rune:"ᚲ",x:55,duration:13},{rune:"ᚷ",x:65,duration:17},{rune:"ᚹ",x:75,duration:14},{rune:"ᚺ",x:85,duration:16},{rune:"ᚾ",x:95,duration:12},{rune:"ᛁ",x:10,duration:19},{rune:"ᛃ",x:30,duration:15},{rune:"ᛈ",x:50,duration:14},{rune:"ᛇ",x:70,duration:16},{rune:"ᛊ",x:90,duration:13}],m=e=>{let{index:t,delay:a}=e,r=d[t%d.length];return(0,n.jsx)(o.E.div,{className:"absolute text-amber-500/20 text-2xl pointer-events-none select-none",style:{left:"".concat(r.x,"%"),bottom:"-20px"},initial:{y:0,opacity:0},animate:{y:-800,opacity:[0,.6,.6,0],x:[0,30,0]},transition:{duration:r.duration,delay:a,repeat:1/0,ease:"linear"},children:r.rune})};function u(){let{setScreen:e,setPlayerName:t,playerName:a,setCampaignCode:d}=(0,r.gT)(),[u,x]=(0,s.useState)("menu"),[h,b]=(0,s.useState)(""),[p,g]=(0,s.useState)(""),[f,v]=(0,s.useState)(""),[j,y]=(0,s.useState)("");(0,s.useEffect)(()=>{let e="DUNGEON.AI",t=0,a=setInterval(()=>{y(e.slice(0,t+1)),++t>=e.length&&clearInterval(a)},150);return()=>clearInterval(a)},[]);let N=async()=>{if(!a.trim()){v("Enter your name, adventurer!");return}r.gT.getState().setCharacter(null),r.gT.getState().clearMessages(),window.__playerSpriteSheet=null,await (0,i.zp)(),d("SOLO_"+Date.now()),e("character-creation")};return(0,n.jsxs)("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-b from-stone-950 via-stone-900 to-black",children:[(0,n.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[Array.from({length:15}).map((e,t)=>(0,n.jsx)(m,{index:t,delay:.8*t},t)),(0,n.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-amber-500/5 rounded-full blur-3xl"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-64 bg-gradient-to-t from-amber-900/10 to-transparent"}),(0,n.jsx)(o.E.div,{className:"absolute top-20 left-10 w-4 h-4 bg-orange-400 rounded-full blur-xl",animate:{opacity:[.3,.6,.4,.7,.3],scale:[1,1.2,1,1.3,1]},transition:{duration:2,repeat:1/0}}),(0,n.jsx)(o.E.div,{className:"absolute top-20 right-10 w-4 h-4 bg-orange-400 rounded-full blur-xl",animate:{opacity:[.5,.3,.6,.4,.5],scale:[1.2,1,1.3,1,1.2]},transition:{duration:2.5,repeat:1/0}})]}),(0,n.jsxs)("div",{className:"relative z-10 h-screen flex flex-col items-center justify-center p-4",children:[(0,n.jsxs)(o.E.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},className:"text-center mb-8",children:[(0,n.jsxs)("div",{className:"relative inline-block",children:[(0,n.jsxs)("h1",{className:"font-serif text-6xl md:text-7xl font-bold tracking-wider",children:[(0,n.jsx)("span",{className:"bg-gradient-to-b from-amber-300 via-amber-500 to-amber-700 bg-clip-text text-transparent drop-shadow-lg",children:j}),(0,n.jsx)(o.E.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"text-amber-500",children:"_"})]}),(0,n.jsx)(o.E.div,{initial:{scaleX:0},animate:{scaleX:1},transition:{delay:1.5,duration:.8},className:"h-1 bg-gradient-to-r from-transparent via-amber-500 to-transparent mt-2"})]}),(0,n.jsx)(o.E.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:2},className:"text-amber-200/60 text-lg mt-4 font-serif italic",children:'"Where every story is uniquely yours..."'}),(0,n.jsxs)(o.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:2.5},className:"flex items-center justify-center gap-4 mt-3 text-stone-500 text-sm",children:[(0,n.jsx)("span",{children:"⚔️ AI Dungeon Master"}),(0,n.jsx)("span",{children:"•"}),(0,n.jsx)("span",{children:"\uD83C\uDFA8 Generated Sprites"}),(0,n.jsx)("span",{children:"•"}),(0,n.jsx)("span",{children:"\uD83D\uDCDC Unique Stories"})]})]}),(0,n.jsxs)(o.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.5,duration:.5},className:"relative w-full max-w-md",children:[(0,n.jsx)("div",{className:"absolute -inset-1 bg-gradient-to-r from-amber-600/20 via-amber-500/10 to-amber-600/20 rounded-2xl blur-lg"}),(0,n.jsxs)("div",{className:"relative bg-stone-900/90 border border-amber-900/50 rounded-2xl p-8 backdrop-blur-sm shadow-2xl shadow-black/50",children:[(0,n.jsxs)(o.E.div,{className:"mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:[(0,n.jsxs)("label",{className:"flex items-center gap-2 text-amber-500/80 text-sm mb-2 font-medium",children:[(0,n.jsx)("span",{children:"⚔️"}),(0,n.jsx)("span",{children:"What shall we call you, adventurer?"})]}),(0,n.jsx)("input",{type:"text",value:a,onChange:e=>{t(e.target.value),v("")},placeholder:"Enter your name...",className:"w-full px-4 py-3 rounded-lg bg-stone-800/80 border border-stone-700 text-stone-100 text-lg placeholder:text-stone-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 focus:outline-none transition-all",maxLength:20})]}),(0,n.jsxs)(c.M,{mode:"wait",children:["menu"===u&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-3",children:[(0,n.jsxs)("button",{onClick:N,className:"w-full py-4 rounded-lg bg-gradient-to-r from-amber-700 via-amber-600 to-amber-700 hover:from-amber-600 hover:via-amber-500 hover:to-amber-600 text-white font-bold text-lg shadow-lg shadow-amber-900/30 transition-all flex items-center justify-center gap-3 group",children:[(0,n.jsx)("span",{className:"text-2xl group-hover:animate-bounce",children:"\uD83C\uDFF0"}),(0,n.jsx)("span",{children:"Solo Adventure"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("button",{onClick:()=>x("create"),className:"py-3 rounded-lg bg-stone-800 hover:bg-stone-700 border border-stone-700 hover:border-amber-700 text-stone-300 hover:text-amber-300 font-medium transition-all flex items-center justify-center gap-2",children:[(0,n.jsx)("span",{children:"✨"}),(0,n.jsx)("span",{children:"Create Party"})]}),(0,n.jsxs)("button",{onClick:()=>x("join"),className:"py-3 rounded-lg bg-stone-800 hover:bg-stone-700 border border-stone-700 hover:border-violet-700 text-stone-300 hover:text-violet-300 font-medium transition-all flex items-center justify-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83C\uDFAF"}),(0,n.jsx)("span",{children:"Join Party"})]})]})]},"menu"),"create"===u&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"flex items-center gap-2 text-amber-500/80 text-sm mb-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDCDC"}),(0,n.jsx)("span",{children:"Name Your Quest"})]}),(0,n.jsx)("input",{type:"text",value:h,onChange:e=>b(e.target.value),placeholder:"The Dragon's Lair...",className:"w-full px-4 py-3 rounded-lg bg-stone-800/80 border border-stone-700 text-stone-100 placeholder:text-stone-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 focus:outline-none transition-all",maxLength:40})]}),(0,n.jsx)("button",{onClick:()=>{if(!a.trim()){v("Enter your name, adventurer!");return}if(!h.trim()){v("Your quest needs a name!");return}d((0,l.$V)()),e("character-creation")},className:"w-full py-3 rounded-lg bg-gradient-to-r from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 text-white font-bold transition-all",children:"Create & Continue →"}),(0,n.jsx)("button",{onClick:()=>x("menu"),className:"w-full py-2 text-stone-500 hover:text-stone-300 text-sm transition-all",children:"← Back"})]},"create"),"join"===u&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"flex items-center gap-2 text-violet-400/80 text-sm mb-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDD11"}),(0,n.jsx)("span",{children:"Enter Party Code"})]}),(0,n.jsx)("input",{type:"text",value:p,onChange:e=>g(e.target.value.toUpperCase()),placeholder:"ABC123",className:"w-full px-4 py-4 rounded-lg bg-stone-800/80 border border-stone-700 text-stone-100 text-center font-mono text-3xl tracking-[0.5em] placeholder:text-stone-600 placeholder:tracking-[0.3em] focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all uppercase",maxLength:6})]}),(0,n.jsx)("button",{onClick:()=>{if(!a.trim()){v("Enter your name, adventurer!");return}if(6!==p.length){v("Campaign code must be 6 characters!");return}d(p.toUpperCase()),e("character-creation")},className:"w-full py-3 rounded-lg bg-gradient-to-r from-violet-700 to-purple-600 hover:from-violet-600 hover:to-purple-500 text-white font-bold transition-all",children:"Join Party →"}),(0,n.jsx)("button",{onClick:()=>x("menu"),className:"w-full py-2 text-stone-500 hover:text-stone-300 text-sm transition-all",children:"← Back"})]},"join")]}),(0,n.jsx)(c.M,{children:f&&(0,n.jsxs)(o.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:"text-red-400 text-sm text-center mt-4 flex items-center justify-center gap-2",children:[(0,n.jsx)("span",{children:"⚠️"}),(0,n.jsx)("span",{children:f})]})})]})]}),(0,n.jsxs)(o.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:3},className:"mt-8 text-center",children:[(0,n.jsx)("p",{className:"text-stone-600 text-xs",children:"Powered by Gemini AI • Imagen 4.0 • Built with ❤️"}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 mt-2 text-stone-700 text-lg",children:[(0,n.jsx)("span",{children:"\uD83D\uDC09"}),(0,n.jsx)("span",{children:"⚔️"}),(0,n.jsx)("span",{children:"\uD83C\uDFF0"}),(0,n.jsx)("span",{children:"\uD83D\uDC8E"}),(0,n.jsx)("span",{children:"\uD83D\uDD2E"})]})]})]})]})}let x=[{id:"black",name:"Raven Black",hex:"#1a1a2e"},{id:"brown",name:"Chestnut Brown",hex:"#8B4513"},{id:"blonde",name:"Golden Blonde",hex:"#F4D03F"},{id:"red",name:"Fiery Red",hex:"#C0392B"},{id:"white",name:"Silver White",hex:"#ECF0F1"},{id:"blue",name:"Mystic Blue",hex:"#3498DB"},{id:"purple",name:"Royal Purple",hex:"#9B59B6"},{id:"green",name:"Forest Green",hex:"#27AE60"}],h=[{id:"brave",name:"Brave",desc:"Fearless in the face of danger",emoji:"\uD83E\uDD81"},{id:"cunning",name:"Cunning",desc:"Always three steps ahead",emoji:"\uD83E\uDD8A"},{id:"noble",name:"Noble",desc:"Honor above all else",emoji:"\uD83D\uDC51"},{id:"mysterious",name:"Mysterious",desc:"Shrouded in secrets",emoji:"\uD83C\uDF19"},{id:"cheerful",name:"Cheerful",desc:"Finding light in darkness",emoji:"☀️"},{id:"vengeful",name:"Vengeful",desc:"Driven by the past",emoji:"\uD83D\uDD25"}],b=[{id:"orphan",name:"Orphan",desc:"Raised on the streets, forged by hardship"},{id:"noble",name:"Fallen Noble",desc:"Once had everything, now seeks redemption"},{id:"soldier",name:"Veteran Soldier",desc:"Wars leave scars that never heal"},{id:"scholar",name:"Exiled Scholar",desc:"Knowledge is power, and power corrupts"},{id:"criminal",name:"Reformed Criminal",desc:"The past is never truly buried"},{id:"wanderer",name:"Wanderer",desc:"No home, no ties, endless horizons"}];function p(){var e,t,a;let{setScreen:d,setCharacter:m,playerName:u}=(0,r.gT)(),[p,g]=(0,s.useState)("basics"),[f,v]=(0,s.useState)(u||""),[j,y]=(0,s.useState)(null),[N,w]=(0,s.useState)(null),[D,C]=(0,s.useState)(!1),[E,S]=(0,s.useState)("brown"),[k,T]=(0,s.useState)("neutral"),[A,I]=(0,s.useState)(null),[M,F]=(0,s.useState)(null),[L,_]=(0,s.useState)({STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10}),[R,O]=(0,s.useState)(27),[G,B]=(0,s.useState)(!1),[H,z]=(0,s.useState)(""),[W,P]=(0,s.useState)(!1),[U,Y]=(0,s.useState)(!1),[X,q]=(0,s.useState)(0),[V,K]=(0,s.useState)(""),[Q,$]=(0,s.useState)(null),[J,Z]=(0,s.useState)(!1),ee=(0,s.useRef)(null),et=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(f.length>=2&&!et.current&&!D){et.current=!0;let e=(0,i.hb)();e.connected?(console.log("[CharCreation] \uD83C\uDFF0 Pre-generating dungeon..."),e.emit("dungeon:pregenerate")):(0,i.zp)().then(()=>{(0,i.hb)().emit("dungeon:pregenerate")})}},[f,D]),(0,s.useEffect)(()=>{let e=e=>{z(t=>t+e.detail.text),ee.current&&(ee.current.scrollTop=ee.current.scrollHeight)},t=()=>{P(!0),ea()},a=e=>{if("character"===e.detail.type){var t;$((null===(t=e.detail.sheet.frames[0])||void 0===t?void 0:t.imageUrl)||e.detail.sheet.sheetUrl),Y(!0),window.__playerSpriteSheet=e.detail.sheet,ea()}},n=e=>{console.error("[Generation] Error:",e.detail.message),Y(!0)},r=e=>{"character"===e.detail.type&&(q(e.detail.progress||0),K(e.detail.message||""))},s=()=>{console.log("[CharCreation] ✅ Dungeon pre-generated!"),C(!0)};window.addEventListener("backstory:chunk",e),window.addEventListener("backstory:complete",t),window.addEventListener("spritesheet:ready",a),window.addEventListener("generation:error",n),window.addEventListener("generation:progress",r),window.addEventListener("dungeon:pregenerated",s);let i=setTimeout(()=>{Y(!0)},18e4);return()=>{clearTimeout(i),window.removeEventListener("backstory:chunk",e),window.removeEventListener("backstory:complete",t),window.removeEventListener("spritesheet:ready",a),window.removeEventListener("generation:error",n),window.removeEventListener("generation:progress",r),window.removeEventListener("dungeon:pregenerated",s)}},[]);let ea=()=>{setTimeout(()=>{(W||H.length>500)&&Z(!0)},2e3)};(0,s.useEffect)(()=>{U&&W&&setTimeout(()=>Z(!0),1500)},[U,W]);let en=e=>e<=13?1:e<=15?2:0,er=(e,t)=>{let a=L[e],n=a+t;if(n<8||n>15)return;let r=Array.from({length:a-8},(e,t)=>en(8+t+1)).reduce((e,t)=>e+t,0),s=Array.from({length:n-8},(e,t)=>en(8+t+1)).reduce((e,t)=>e+t,0)-r;s>R||(_({...L,[e]:n}),O(R-s))},es=()=>{if(!j)return L;let e=r.Ae[j].bonus;return{STR:L.STR+(e.STR||0),DEX:L.DEX+(e.DEX||0),CON:L.CON+(e.CON||0),INT:L.INT+(e.INT||0),WIS:L.WIS+(e.WIS||0),CHA:L.CHA+(e.CHA||0)}},ei=async()=>{if(!j||!N)return;let e=es(),t=10+(0,l.G4)(e.CON)+Math.floor(e.CON/2),a={id:(0,l.Ox)(),name:f||"The Stranger",race:j,class:N,level:1,stats:e,hp:t,maxHp:t,mana:"mage"===N?20:10,maxMana:"mage"===N?20:10,portrait:Q||"/portraits/default.png",inventory:[],spriteKey:"".concat(N,"_idle")};localStorage.setItem("playerBackstory",H);let n=(0,i.hb)();(null==n?void 0:n.connected)||(console.log("[CharCreation] Socket disconnected, reconnecting..."),await (0,i.zp)()),console.log("[CharCreation] Emitting game:init for",a.name),n.emit("game:init",{name:a.name,race:a.race,class:a.class,spriteSheet:window.__playerSpriteSheet}),await new Promise(e=>setTimeout(e,100)),console.log("[CharCreation] Entering game with character:",a.name),m(a),d("game")};return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-stone-900 via-stone-950 to-black flex items-center justify-center p-4",children:(0,n.jsxs)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-stone-900/90 border border-amber-900/40 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl shadow-amber-900/20",children:["generating"!==p&&"reveal"!==p&&(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("h1",{className:"font-serif text-3xl text-amber-400 mb-2",children:{basics:"Origin",appearance:"Appearance",personality:"Soul",stats:"Abilities",generating:"Destiny Unfolds",reveal:"Your Legend Begins"}[p]}),(0,n.jsx)("div",{className:"flex gap-2 justify-center",children:["basics","appearance","personality","stats"].map((e,t)=>(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all ".concat(["basics","appearance","personality","stats"].indexOf(p)>=t?"bg-amber-500 shadow-lg shadow-amber-500/50":"bg-stone-700")},e))})]}),(0,n.jsxs)(c.M,{mode:"wait",children:["basics"===p&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"What shall you be called?"}),(0,n.jsx)("input",{type:"text",value:f,onChange:e=>v(e.target.value),placeholder:"Enter your name...",className:"w-full px-4 py-3 rounded-lg bg-stone-800/80 border border-stone-700 text-stone-100 text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20",maxLength:24})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"Choose Your Race"}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(r.Ae).map(e=>{let[t,a]=e;return(0,n.jsxs)("button",{onClick:()=>y(t),className:"p-3 rounded-lg text-center transition-all border ".concat(j===t?"bg-amber-900/50 border-amber-500 shadow-lg shadow-amber-500/20":"bg-stone-800/50 border-stone-700 hover:border-amber-700"),children:[(0,n.jsx)("div",{className:"text-2xl mb-1",children:"human"===t?"\uD83D\uDC64":"elf"===t?"\uD83E\uDDDD":"dwarf"===t?"\uD83E\uDE93":"halfling"===t?"\uD83C\uDF40":"dragonborn"===t?"\uD83D\uDC09":"\uD83D\uDE08"}),(0,n.jsx)("div",{className:"font-serif text-sm text-stone-200",children:a.name})]},t)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"Choose Your Path"}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(r.GG).map(e=>{let[t,a]=e;return(0,n.jsxs)("button",{onClick:()=>w(t),className:"p-3 rounded-lg text-center transition-all border ".concat(N===t?"bg-amber-900/50 border-amber-500 shadow-lg shadow-amber-500/20":"bg-stone-800/50 border-stone-700 hover:border-amber-700"),children:[(0,n.jsx)("div",{className:"text-2xl mb-1",children:"warrior"===t?"⚔️":"mage"===t?"\uD83E\uDDD9":"rogue"===t?"\uD83D\uDDE1️":"cleric"===t?"✨":"ranger"===t?"\uD83C\uDFF9":"\uD83D\uDEE1️"}),(0,n.jsx)("div",{className:"font-serif text-sm text-stone-200",children:a.name})]},t)})})]}),(0,n.jsx)("button",{onClick:()=>g("appearance"),disabled:!j||!N,className:"w-full py-3 rounded-lg bg-gradient-to-r from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 text-white font-bold disabled:opacity-50 transition-all",children:"Continue →"})]},"basics"),"appearance"===p&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"Presentation"}),(0,n.jsx)("div",{className:"flex gap-3",children:[{id:"masculine",label:"Masculine",emoji:"♂️"},{id:"feminine",label:"Feminine",emoji:"♀️"},{id:"neutral",label:"Androgynous",emoji:"⚧️"}].map(e=>(0,n.jsxs)("button",{onClick:()=>T(e.id),className:"flex-1 p-3 rounded-lg text-center transition-all border ".concat(k===e.id?"bg-violet-900/50 border-violet-500":"bg-stone-800/50 border-stone-700 hover:border-violet-700"),children:[(0,n.jsx)("div",{className:"text-xl",children:e.emoji}),(0,n.jsx)("div",{className:"text-sm text-stone-300",children:e.label})]},e.id))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"Hair Color"}),(0,n.jsx)("div",{className:"grid grid-cols-4 gap-2",children:x.map(e=>(0,n.jsxs)("button",{onClick:()=>S(e.id),className:"p-2 rounded-lg text-center transition-all border ".concat(E===e.id?"border-amber-500 ring-2 ring-amber-500/30":"border-stone-700 hover:border-amber-700"),children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full mx-auto mb-1 border-2 border-stone-600",style:{backgroundColor:e.hex}}),(0,n.jsx)("div",{className:"text-xs text-stone-400",children:e.name})]},e.id))})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:()=>g("basics"),className:"flex-1 py-3 rounded-lg bg-stone-800 hover:bg-stone-700 text-stone-300",children:"← Back"}),(0,n.jsx)("button",{onClick:()=>g("personality"),className:"flex-1 py-3 rounded-lg bg-gradient-to-r from-amber-700 to-amber-600 text-white font-bold",children:"Continue →"})]})]},"appearance"),"personality"===p&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"Your Nature"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:h.map(e=>(0,n.jsxs)("button",{onClick:()=>I(e.id),className:"p-3 rounded-lg text-left transition-all border ".concat(A===e.id?"bg-amber-900/50 border-amber-500":"bg-stone-800/50 border-stone-700 hover:border-amber-700"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xl",children:e.emoji}),(0,n.jsx)("span",{className:"font-serif text-stone-200",children:e.name})]}),(0,n.jsx)("p",{className:"text-xs text-stone-500 mt-1",children:e.desc})]},e.id))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-amber-500/80 text-sm mb-2 font-medium",children:"Your Past"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:b.map(e=>(0,n.jsxs)("button",{onClick:()=>F(e.id),className:"p-3 rounded-lg text-left transition-all border ".concat(M===e.id?"bg-violet-900/50 border-violet-500":"bg-stone-800/50 border-stone-700 hover:border-violet-700"),children:[(0,n.jsx)("div",{className:"font-serif text-stone-200",children:e.name}),(0,n.jsx)("p",{className:"text-xs text-stone-500 mt-1",children:e.desc})]},e.id))})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:()=>g("appearance"),className:"flex-1 py-3 rounded-lg bg-stone-800 hover:bg-stone-700 text-stone-300",children:"← Back"}),(0,n.jsx)("button",{onClick:()=>g("stats"),disabled:!A||!M,className:"flex-1 py-3 rounded-lg bg-gradient-to-r from-amber-700 to-amber-600 text-white font-bold disabled:opacity-50",children:"Continue →"})]})]},"personality"),"stats"===p&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-stone-400",children:"Distribute your abilities"}),(0,n.jsxs)("span",{className:"text-amber-500 font-mono",children:["Points: ",(0,n.jsx)("span",{className:"text-xl font-bold",children:R})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:r.Ei.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-3 bg-stone-800/30 rounded-lg p-3",children:[(0,n.jsx)("span",{className:"w-10 font-mono text-stone-400 text-sm",children:e}),(0,n.jsx)("button",{onClick:()=>er(e,-1),className:"w-8 h-8 rounded bg-stone-700 hover:bg-stone-600",disabled:L[e]<=8,children:"-"}),(0,n.jsx)("span",{className:"w-8 text-center font-mono text-lg text-stone-200",children:L[e]}),(0,n.jsx)("button",{onClick:()=>er(e,1),className:"w-8 h-8 rounded bg-stone-700 hover:bg-stone-600",disabled:L[e]>=15,children:"+"}),(0,n.jsx)("span",{className:"text-sm ".concat((0,l.G4)(es()[e])>=0?"text-emerald-400":"text-red-400"),children:(0,l.vd)((0,l.G4)(es()[e]))})]},e))}),(0,n.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,n.jsx)("button",{onClick:()=>g("personality"),className:"flex-1 py-3 rounded-lg bg-stone-800 hover:bg-stone-700 text-stone-300",children:"← Back"}),(0,n.jsx)("button",{onClick:()=>{if(!j||!N||!A||!M)return;g("generating"),B(!0),z(""),P(!1),Y(!1),Z(!1);let e=(0,i.hb)();e.emit("backstory:generate",{name:f||"The Stranger",race:j,class:N,personality:A,background:M,hairColor:E,gender:k}),e.emit("spritesheet:character",{name:f||"Adventurer",race:j,class:N,hairColor:E,gender:k,fullSheet:!0})},className:"flex-1 py-3 rounded-lg bg-gradient-to-r from-violet-700 to-purple-600 hover:from-violet-600 hover:to-purple-500 text-white font-bold",children:"✨ Forge My Destiny"})]})]},"stats"),"generating"===p&&(0,n.jsxs)(o.E.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(o.E.div,{animate:{rotate:360},transition:{repeat:1/0,duration:3,ease:"linear"},className:"text-5xl mb-4",children:"✨"}),(0,n.jsx)("h2",{className:"font-serif text-2xl text-amber-400 mb-2",children:"The Fates Are Weaving..."}),(0,n.jsx)("p",{className:"text-stone-500 text-sm",children:"Your legend is being written"})]}),(0,n.jsx)("div",{ref:ee,className:"bg-stone-950/80 rounded-lg p-4 h-64 overflow-y-auto border border-amber-900/30",children:(0,n.jsxs)("p",{className:"text-stone-300 font-serif leading-relaxed whitespace-pre-wrap",children:[H,(0,n.jsx)(o.E.span,{animate:{opacity:[1,0]},transition:{repeat:1/0,duration:.8},className:"text-amber-500",children:"▌"})]})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-center gap-8 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 ".concat(W?"text-emerald-400":"text-amber-500"),children:[W?"✓":(0,n.jsx)(o.E.span,{animate:{rotate:360},transition:{repeat:1/0,duration:1},children:"⟳"}),(0,n.jsx)("span",{children:"Backstory"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 ".concat(U?"text-emerald-400":"text-amber-500"),children:[U?"✓":(0,n.jsx)(o.E.span,{animate:{rotate:360},transition:{repeat:1/0,duration:1},children:"⟳"}),(0,n.jsxs)("span",{children:["Sprite Sheet (",Math.round(X),"%)"]})]})]}),!U&&X>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-2 bg-stone-800 rounded-full overflow-hidden",children:(0,n.jsx)(o.E.div,{className:"h-full bg-gradient-to-r from-amber-600 to-amber-400",initial:{width:0},animate:{width:"".concat(X,"%")},transition:{duration:.3}})}),(0,n.jsx)("p",{className:"text-center text-stone-500 text-xs",children:V||"Generating poses..."})]})]}),J&&(0,n.jsx)(o.E.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onClick:()=>{g("reveal")},className:"w-full py-4 rounded-lg bg-gradient-to-r from-amber-600 to-yellow-500 hover:from-amber-500 hover:to-yellow-400 text-black font-bold text-lg shadow-lg shadow-amber-500/30",children:"⚔️ Reveal Your Character"})]},"generating"),"reveal"===p&&(0,n.jsxs)(o.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-center space-y-6",children:[(0,n.jsxs)(o.E.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},children:[(0,n.jsx)("h1",{className:"font-serif text-4xl text-amber-400 mb-2",children:f||"The Stranger"}),(0,n.jsxs)("p",{className:"text-stone-400",children:[j&&r.Ae[j].name," ",N&&r.GG[N].name]})]}),(0,n.jsxs)(o.E.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.5,duration:.7,type:"spring"},className:"relative mx-auto",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500 to-yellow-500 rounded-full blur-xl opacity-50 animate-pulse"}),(0,n.jsx)("div",{className:"relative w-40 h-40 mx-auto rounded-full border-4 border-amber-500 bg-stone-900 flex items-center justify-center overflow-hidden shadow-2xl shadow-amber-500/30",children:Q?(0,n.jsx)("img",{src:Q,alt:f,className:"w-full h-full object-contain",style:{imageRendering:"auto"}}):(0,n.jsx)("span",{className:"text-6xl",children:"mage"===N?"\uD83E\uDDD9":"warrior"===N?"⚔️":"rogue"===N?"\uD83D\uDDE1️":"✨"})})]}),(0,n.jsxs)(o.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"flex justify-center gap-4 text-sm",children:[(0,n.jsxs)("span",{className:"px-3 py-1 rounded-full bg-amber-900/50 text-amber-400",children:[null===(e=h.find(e=>e.id===A))||void 0===e?void 0:e.emoji," ",null===(t=h.find(e=>e.id===A))||void 0===t?void 0:t.name]}),(0,n.jsx)("span",{className:"px-3 py-1 rounded-full bg-violet-900/50 text-violet-400",children:null===(a=b.find(e=>e.id===M))||void 0===a?void 0:a.name})]}),(0,n.jsx)(o.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.2},className:"bg-stone-950/60 rounded-lg p-4 max-h-32 overflow-y-auto border border-stone-800",children:(0,n.jsxs)("p",{className:"text-stone-400 text-sm font-serif italic leading-relaxed",children:['"',H.slice(0,300),'..."']})}),(0,n.jsx)(o.E.button,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:1.5},onClick:ei,className:"w-full py-4 rounded-lg bg-gradient-to-r from-amber-600 via-yellow-500 to-amber-600 hover:from-amber-500 hover:via-yellow-400 hover:to-amber-500 text-black font-bold text-xl shadow-lg shadow-amber-500/30 animate-pulse",children:"⚔️ Enter the Dungeon"})]},"reveal")]})]})})}function g(e){let{spriteSheet:t,fallbackEmoji:a="⚔️",currentAnimation:r="idle",size:i=128,className:l="",onAnimationEnd:c}=e,[d,m]=(0,s.useState)(0),[u,x]=(0,s.useState)(null),h=(0,s.useRef)(0),b=(0,s.useRef)(0);(0,s.useEffect)(()=>{if(!t)return;let e=t.animations.find(e=>e.name===r);e&&(x(e),m(0))},[t,r]),(0,s.useEffect)(()=>{if(!u||!t)return;let e=1e3/u.frameRate,a=t=>{t-b.current>=e&&(b.current=t,m(e=>{let t=e+1;return t>=u.frames.length?u.loop?0:(null==c||c(u.name),e):t})),h.current=requestAnimationFrame(a)};return h.current=requestAnimationFrame(a),()=>{cancelAnimationFrame(h.current)}},[u,t,c]);let p=(0,s.useCallback)(()=>{if(!t||!u)return null;let e=u.frames[d];if(!e)return null;let a=t.frames.find(t=>t.name===e);return(null==a?void 0:a.imageUrl)||null},[t,u,d])(),[g,f]=(0,s.useState)(0);return((0,s.useEffect)(()=>{if("idle"!==r)return;let e=setInterval(()=>{f(2*Math.sin(Date.now()/600))},50);return()=>clearInterval(e)},[r]),t&&0!==t.frames.length)?(0,n.jsxs)(o.E.div,{className:"relative ".concat(l),style:{width:i,height:i},animate:{y:"idle"===r?g:0,scale:"attack"===r?[1,1.1,1]:"special"===r?[1,1.2,1.1]:"hurt"===r?[1,.9,1]:1},transition:{duration:.2},children:[(0,n.jsx)("div",{className:"absolute inset-0 rounded-full blur-xl ".concat("special"===r?"bg-purple-500/60":"powerup"===r?"bg-yellow-500/60":"cast"===r?"bg-blue-500/60":"bg-amber-500/30"),style:{transform:"scale(1.2)"}}),p?(0,n.jsx)("img",{src:p,alt:"Character",className:"relative z-10 w-full h-full object-contain",style:{imageRendering:"pixelated",filter:"hurt"===r?"brightness(1.5) saturate(0.5)":"powerup"===r?"brightness(1.3)":"special"===r?"brightness(1.2) saturate(1.2)":"none"}}):(0,n.jsx)("div",{className:"relative z-10 rounded-full bg-gradient-to-br from-amber-500 to-amber-700 flex items-center justify-center w-full h-full",children:(0,n.jsx)("span",{style:{fontSize:.4*i},children:a})}),"special"===r&&(0,n.jsx)(o.E.div,{className:"absolute inset-0 z-20 pointer-events-none",animate:{opacity:[0,1,0]},transition:{duration:.3,repeat:1/0},children:(0,n.jsx)("div",{className:"w-full h-full bg-gradient-radial from-purple-400/50 to-transparent"})}),"cast"===r&&(0,n.jsx)(o.E.div,{className:"absolute -inset-4 z-20 pointer-events-none",animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:(0,n.jsx)("div",{className:"w-full h-full border-2 border-blue-400/30 rounded-full border-dashed"})})]}):(0,n.jsx)(o.E.div,{className:"flex items-center justify-center ".concat(l),style:{width:i,height:i},animate:{y:g},children:(0,n.jsx)("div",{className:"rounded-full bg-gradient-to-br from-amber-500 to-amber-700 flex items-center justify-center shadow-lg shadow-amber-500/50",style:{width:.8*i,height:.8*i},children:(0,n.jsx)("span",{style:{fontSize:.4*i},children:a})})})}let f={entrance:{id:"entrance",name:"Dungeon Entrance",description:"Ancient stone steps descend into darkness. Torchlight flickers on moss-covered walls.",exits:["north"],entities:[]},corridor:{id:"corridor",name:"Dark Corridor",description:"A narrow passage stretches before you. Water drips from the ceiling.",exits:["north","south"],entities:[]},chamber:{id:"chamber",name:"Guard Chamber",description:"A large chamber with broken pillars. Something stirs in the shadows...",exits:["south","east"],entities:[{id:"goblin1",name:"Goblin Scout",type:"enemy",emoji:"\uD83D\uDC7A"}]},treasure:{id:"treasure",name:"Treasure Vault",description:"Gold gleams in the dim light. An ornate chest sits against the far wall.",exits:["west"],entities:[{id:"chest1",name:"Treasure Chest",type:"item",emoji:"\uD83D\uDCE6"}]}};function v(){let{character:e}=(0,r.gT)(),[t,a]=(0,s.useState)(f.entrance),[l,d]=(0,s.useState)(null),[m,u]=(0,s.useState)(!1),[x,h]=(0,s.useState)({x:50,y:70}),[b,p]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),[y,N]=(0,s.useState)("idle");(0,s.useEffect)(()=>{{let e=window.__playerSpriteSheet;e&&j(e)}},[e]);let w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500;console.log("[DungeonScene] Playing animation:",e,"for",t,"ms"),N(e),"idle"!==e&&setTimeout(()=>{console.log("[DungeonScene] Animation complete, returning to idle"),N("idle")},t)},D=async e=>{u(!0);let t=(0,i.hb)();if(!(null==t?void 0:t.connected)){console.log("[DungeonScene] Socket not connected, retrying in 1s..."),setTimeout(()=>D(e),1e3);return}console.log("[DungeonScene] Requesting room image:",e.name),t.emit("generate:room",{roomType:e.id,description:e.description,name:e.name})};return(0,s.useEffect)(()=>{let e=e=>{console.log("[DungeonScene] Room image received, fallback:",e.detail.fallback),e.detail.fallback||"fallback"===e.detail.imageUrl?d(null):d(e.detail.imageUrl),u(!1)},n=e=>{var t,a,n;let r=(null===(t=e.detail)||void 0===t?void 0:t.anim)||(null===(a=e.detail)||void 0===a?void 0:a.animation),s=(null===(n=e.detail)||void 0===n?void 0:n.duration)||1500;console.log("[DungeonScene] Animation event:",r,"duration:",s),r&&w(r,s)},r=e=>{let{x:t,y:a,anim:n,positionChange:r}=e.detail||{};if(console.log("[DungeonScene] Player moved:",{x:t,y:a,anim:n,positionChange:r}),n&&w(n,2e3),r){p(!0);let{dx:e,dy:t,steps:a}=r;h({x:Math.max(20,Math.min(80,x.x+e*a*8)),y:Math.max(40,Math.min(85,x.y+t*a*5))}),setTimeout(()=>{p(!1),N("idle")},2e3)}},s=e=>{var t,n;let r=(null===(t=e.detail)||void 0===t?void 0:t.roomId)||(null===(n=e.detail)||void 0===n?void 0:n.room);r&&f[r]&&(p(!0),h({x:50,y:120}),setTimeout(()=>{a(f[r]),d(null),D(f[r]),h({x:50,y:-20}),setTimeout(()=>{h({x:50,y:70}),p(!1)},100)},500))};window.addEventListener("room:image:ready",e),window.addEventListener("player:anim",n),window.addEventListener("player:moved",r),window.addEventListener("room:change",s);let i=setTimeout(()=>{D(t)},500);return()=>{clearTimeout(i),window.removeEventListener("room:image:ready",e),window.removeEventListener("player:anim",n),window.removeEventListener("player:moved",r),window.removeEventListener("room:change",s)}},[]),(0,n.jsxs)("div",{className:"relative w-full h-full overflow-hidden bg-black",children:[(0,n.jsx)(c.M,{mode:"wait",children:(0,n.jsxs)(o.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"absolute inset-0",children:[l?(0,n.jsx)("img",{src:l,alt:t.name,className:"w-full h-full object-cover"}):(0,n.jsxs)("div",{className:"w-full h-full relative overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-stone-800 via-stone-900 to-black"}),(0,n.jsx)("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E\")",backgroundSize:"150px 150px"}}),(0,n.jsx)("div",{className:"absolute top-1/4 left-1/6 w-32 h-48 bg-orange-500/20 blur-3xl rounded-full animate-pulse"}),(0,n.jsx)("div",{className:"absolute top-1/3 right-1/5 w-28 h-40 bg-amber-500/15 blur-3xl rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-64 h-80",children:(0,n.jsx)("div",{className:"w-full h-full bg-black/60 rounded-t-full"})}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-stone-950 to-transparent"}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:m?(0,n.jsxs)("div",{className:"space-y-4 text-center",children:[(0,n.jsx)(o.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"text-5xl",children:"\uD83C\uDFA8"}),(0,n.jsx)("p",{className:"text-amber-500/60 text-sm",children:"Conjuring vision..."})]}):null})]}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-radial from-transparent via-transparent to-black/60 pointer-events-none"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-black/20 pointer-events-none"})]},t.id)}),(0,n.jsx)(o.E.div,{className:"absolute z-10",animate:{left:"".concat(x.x,"%"),top:"".concat(x.y,"%"),scale:b?[1,1.05,1]:1},transition:{left:{duration:b?1.5:.3,ease:"easeInOut"},top:{duration:b?1.5:.3,ease:"easeInOut"},scale:{duration:.3}},style:{transform:"translate(-50%, -50%)"},children:(0,n.jsx)(g,{spriteSheet:v,fallbackEmoji:(null==e?void 0:e.class)==="mage"?"\uD83E\uDDD9":(null==e?void 0:e.class)==="rogue"?"\uD83D\uDDE1️":"⚔️",currentAnimation:b?"walk":y,size:128})}),(0,n.jsx)("div",{className:"absolute top-4 left-4 right-4 z-20",children:(0,n.jsxs)(o.E.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"bg-black/70 backdrop-blur-sm rounded-lg p-4 border border-amber-900/30",children:[(0,n.jsx)("h2",{className:"font-serif text-xl text-amber-400",children:t.name}),(0,n.jsx)("p",{className:"text-stone-400 text-sm mt-1",children:t.description})]})}),t.entities.length>0&&(0,n.jsx)("div",{className:"absolute top-24 right-4 z-20 space-y-2",children:t.entities.map(e=>(0,n.jsxs)(o.E.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},className:"px-3 py-2 rounded-lg backdrop-blur-sm border flex items-center gap-2 ".concat("enemy"===e.type?"bg-red-900/50 border-red-700/50 text-red-300":"item"===e.type?"bg-amber-900/50 border-amber-700/50 text-amber-300":"bg-green-900/50 border-green-700/50 text-green-300"),children:[(0,n.jsx)("span",{className:"text-xl",children:e.emoji}),(0,n.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})]})}function j(){let{messages:e,connected:t}=(0,r.gT)(),a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[e]),(0,n.jsxs)("div",{className:"h-full flex flex-col bg-gradient-to-b from-stone-900 to-stone-950",children:[(0,n.jsx)("div",{className:"p-3 border-b border-amber-900/30 bg-stone-900/80 backdrop-blur",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("h2",{className:"font-serif text-amber-400 text-lg flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCDC"}),"Chronicle"]}),(0,n.jsx)("div",{className:"text-xs px-2 py-1 rounded ".concat(t?"bg-emerald-900/50 text-emerald-400":"bg-red-900/50 text-red-400"),children:t?"⚡ Connected":"⚠ Disconnected"})]})}),(0,n.jsxs)("div",{ref:a,className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-amber-900/50",children:[0===e.length&&(0,n.jsxs)("div",{className:"text-center text-stone-500 py-12",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDFF0"}),(0,n.jsx)("p",{className:"font-serif text-lg",children:"Your adventure awaits..."}),(0,n.jsx)("p",{className:"text-sm mt-2 text-stone-600",children:"Describe your first action below"})]}),(0,n.jsx)(c.M,{initial:!1,children:e.map(e=>(0,n.jsx)(o.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},children:(0,n.jsx)(y,{message:e})},e.id))})]})]})}function y(e){let{message:t}=e;if("system"===t.type)return(0,n.jsx)("div",{className:"text-center text-stone-500 text-xs italic py-2 px-4",children:t.content});let a="dm"===t.type;return(0,n.jsxs)("div",{className:"rounded-lg p-4 ".concat(a?"bg-gradient-to-r from-amber-950/60 to-stone-900/60 border-l-4 border-amber-600 shadow-lg shadow-amber-900/20":"bg-gradient-to-r from-violet-950/40 to-stone-900/40 border-l-4 border-violet-500"),children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,n.jsx)("span",{className:"text-xs font-bold tracking-wide uppercase ".concat(a?"text-amber-500":"text-violet-400"),children:a?"\uD83D\uDC09 Dungeon Master":"⚔️ ".concat(t.sender||"You")}),(0,n.jsx)("span",{className:"text-xs text-stone-600",children:(0,l.i$)(t.timestamp)})]}),(0,n.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap ".concat(a?"text-stone-200 font-serif":"text-stone-300"),children:t.content})]})}function N(){var e;let{character:t}=(0,r.gT)(),[a,i]=(0,s.useState)(null);if((0,s.useEffect)(()=>{var e,a;let n=window.__playerSpriteSheet;(null==n?void 0:null===(a=n.frames)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.imageUrl)?i(n.frames[0].imageUrl):(null==t?void 0:t.portrait)&&!t.portrait.includes("default")&&i(t.portrait)},[t]),!t)return(0,n.jsx)("div",{className:"h-full flex items-center justify-center text-stone-500",children:(0,n.jsx)("p",{children:"No character loaded"})});let c=t.hp/t.maxHp*100,d=t.mana/t.maxMana*100;return(0,n.jsxs)("div",{className:"h-full overflow-y-auto p-4 space-y-6 bg-gradient-to-b from-stone-900 to-stone-950",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(o.E.div,{className:"w-24 h-24 mx-auto mb-3 rounded-lg bg-gradient-to-br from-violet-900/50 to-stone-800 border-2 border-amber-700/50 shadow-lg shadow-amber-900/20 flex items-center justify-center overflow-hidden",animate:{y:[0,-3,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:a?(0,n.jsx)("img",{src:a,alt:t.name,className:"w-full h-full object-contain",style:{imageRendering:"auto"}}):(0,n.jsx)("span",{className:"text-4xl",children:"mage"===t.class?"\uD83E\uDDD9":"warrior"===t.class?"⚔️":"rogue"===t.class?"\uD83D\uDDE1️":"cleric"===t.class?"✝️":"ranger"===t.class?"\uD83C\uDFF9":"paladin"===t.class?"\uD83D\uDEE1️":"\uD83D\uDC64"})}),(0,n.jsx)("h2",{className:"font-serif text-xl text-amber-400 font-bold",children:t.name}),(0,n.jsxs)("p",{className:"text-stone-400 text-sm",children:["Level ",t.level," ",t.race.charAt(0).toUpperCase()+t.race.slice(1)," ",(null===(e=r.GG[t.class])||void 0===e?void 0:e.name)||t.class]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,n.jsxs)("span",{className:"text-red-400 flex items-center gap-1",children:[(0,n.jsx)("span",{children:"❤️"})," HP"]}),(0,n.jsxs)("span",{className:"text-stone-300 font-mono",children:[t.hp," / ",t.maxHp]})]}),(0,n.jsx)("div",{className:"h-3 bg-stone-800 rounded-full overflow-hidden border border-stone-700",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-red-700 to-red-500 transition-all duration-300",style:{width:"".concat(c,"%")}})})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,n.jsxs)("span",{className:"text-blue-400 flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDC8E"})," Mana"]}),(0,n.jsxs)("span",{className:"text-stone-300 font-mono",children:[t.mana," / ",t.maxMana]})]}),(0,n.jsx)("div",{className:"h-3 bg-stone-800 rounded-full overflow-hidden border border-stone-700",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-700 to-blue-500 transition-all duration-300",style:{width:"".concat(d,"%")}})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-amber-500 text-sm font-bold uppercase tracking-wide mb-3 border-b border-amber-900/30 pb-2",children:"Attributes"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:r.Ei.map(e=>{let a=t.stats[e],r=(0,l.G4)(a);return(0,n.jsxs)("div",{className:"bg-stone-800/50 rounded-lg p-3 border border-stone-700/50",children:[(0,n.jsx)("div",{className:"text-stone-500 text-xs uppercase tracking-wider",children:e}),(0,n.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,n.jsx)("span",{className:"text-2xl font-bold text-stone-200",children:a}),(0,n.jsx)("span",{className:"text-sm font-mono ".concat(r>=0?"text-emerald-400":"text-red-400"),children:(0,l.vd)(r)})]})]},e)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-amber-500 text-sm font-bold uppercase tracking-wide mb-3 border-b border-amber-900/30 pb-2",children:"Inventory"}),0===t.inventory.length?(0,n.jsx)("p",{className:"text-stone-600 text-sm italic",children:"Your pack is empty..."}):(0,n.jsx)("div",{className:"space-y-2",children:t.inventory.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-stone-300",children:[(0,n.jsx)("span",{children:e.icon||"\uD83D\uDCE6"}),(0,n.jsx)("span",{children:e.name}),e.quantity>1&&(0,n.jsxs)("span",{className:"text-stone-500",children:["\xd7",e.quantity]})]},e.id))})]})]})}function w(){let{combat:e}=(0,r.gT)();return e.active?(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)(o.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"dungeon-panel p-3 text-center",children:[(0,n.jsxs)("div",{className:"text-dungeon-gold font-fantasy text-lg",children:["⚔️ COMBAT - Round ",e.turn]}),e.currentTurnId&&(0,n.jsxs)("div",{className:"text-sm text-dungeon-muted mt-1",children:[(()=>{let t=e.initiative.find(t=>t.id===e.currentTurnId);return(null==t?void 0:t.name)||"Unknown"})(),"'s turn"]})]}),(0,n.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 px-1",children:(0,n.jsx)(c.M,{children:e.initiative.map((t,a)=>(0,n.jsx)(o.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{delay:.1*a},children:(0,n.jsx)(D,{participant:t,isActive:t.id===e.currentTurnId,position:a+1})},t.id))})}),e.log.length>0&&(0,n.jsx)(o.E.div,{initial:{opacity:0},animate:{opacity:1},className:"dungeon-panel p-2 max-h-24 overflow-y-auto",children:(0,n.jsx)("div",{className:"space-y-1",children:e.log.slice(-5).map(e=>(0,n.jsxs)("div",{className:"text-xs text-dungeon-muted flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-dungeon-accent",children:e.actor}),(0,n.jsx)("span",{children:e.message}),e.roll&&(0,n.jsxs)("span",{className:"font-mono ".concat(e.roll.critical?"text-dungeon-gold font-bold":e.roll.success?"text-green-400":"text-red-400"),children:["[",e.roll.dice,": ",e.roll.total,"]"]})]},e.id))})})]}):null}function D(e){let{participant:t,isActive:a,position:r}=e,s=(0,l.QO)(t.hp,t.maxHp),i=t.hp<=0;return(0,n.jsxs)("div",{className:"dungeon-panel p-2 min-w-[80px] transition-all relative ".concat(a?"border-dungeon-gold shadow-gold-glow scale-105":i?"opacity-50":""),children:[(0,n.jsxs)("div",{className:"text-xs text-dungeon-muted mb-1 text-center",children:["#",r]}),(0,n.jsx)("div",{className:"w-12 h-12 mx-auto mb-2 rounded overflow-hidden bg-dungeon-bg flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-2xl",children:"player"===t.type?"⚔️":"\uD83D\uDC79"})}),(0,n.jsx)("div",{className:"text-xs text-center truncate mb-1 ".concat("player"===t.type?"text-dungeon-accent":"text-dungeon-crimson"),children:t.name}),(0,n.jsx)("div",{className:"health-bar h-2",children:(0,n.jsx)(o.E.div,{className:"h-full ".concat("player"===t.type?"health-bar-fill":"bg-dungeon-crimson"),animate:{width:"".concat(s,"%")},transition:{duration:.3}})}),(0,n.jsxs)("div",{className:"text-xs text-center mt-1 font-mono text-dungeon-muted",children:[t.hp,"/",t.maxHp]}),a&&(0,n.jsx)(o.E.div,{className:"absolute -top-1 -right-1 w-3 h-3 bg-dungeon-gold rounded-full",animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1}})]})}let C=[{label:"Look Around",action:"I look around and examine my surroundings carefully",icon:"\uD83D\uDC40"},{label:"Search",action:"I search the area for anything interesting or hidden",icon:"\uD83D\uDD0D"},{label:"Move Forward",action:"I cautiously move forward deeper into the dungeon",icon:"\uD83D\uDEB6"},{label:"Attack",action:"I ready my weapon and attack!",icon:"⚔️"},{label:"Defend",action:"I take a defensive stance, preparing for danger",icon:"\uD83D\uDEE1️"},{label:"Cast Spell",action:"I channel my magical energy and cast a spell",icon:"✨"},{label:"Talk",action:"I attempt to communicate",icon:"\uD83D\uDCAC"},{label:"Rest",action:"I take a moment to catch my breath and rest",icon:"\uD83C\uDFD5️"}];function E(){let{combat:e,character:t,isLoading:a,setIsLoading:c,addMessage:d}=(0,r.gT)(),[m,u]=(0,s.useState)(""),x=(0,s.useRef)(null),h=e.active&&"player"===e.currentTurnId,b=e=>{if(!e.trim())return;let a=(0,i.hb)();console.log("[ActionInput] Sending action:",e),d({id:(0,l.Ox)(),timestamp:Date.now(),type:"player",sender:(null==t?void 0:t.name)||"You",content:e}),c(!0),a.emit("player:action",{action:e})},p=async()=>{m.trim()&&!a&&(b(m.trim()),u(""))},g=e=>{a||b(e)};return(0,n.jsxs)("div",{className:"space-y-3 bg-gradient-to-t from-stone-950 to-stone-900 p-4 border-t border-amber-900/30",children:[(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:C.map(e=>(0,n.jsxs)("button",{onClick:()=>g(e.action),disabled:a,className:" px-3 py-1.5 rounded-full text-xs font-medium bg-stone-800/80 hover:bg-amber-900/60  border border-stone-700 hover:border-amber-600 text-stone-300 hover:text-amber-200 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5 shadow-sm hover:shadow-amber-900/30 ",children:[(0,n.jsx)("span",{children:e.icon}),(0,n.jsx)("span",{children:e.label})]},e.label))}),(0,n.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,n.jsxs)("div",{className:"flex-1 relative",children:[(0,n.jsx)("textarea",{ref:x,value:m,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},placeholder:e.active?h?"⚔️ Your turn! Describe your combat action...":"⏳ Waiting for your turn...":"\uD83C\uDFAD What do you do? Describe your action in natural language...",disabled:a||e.active&&!h,rows:2,className:" w-full px-4 py-3 rounded-lg bg-stone-800/60 border border-stone-700/50 focus:border-amber-600 focus:ring-2 focus:ring-amber-600/20 text-stone-200 placeholder-stone-500 resize-none transition-all duration-200 font-serif text-sm disabled:opacity-50 "}),m.length>0&&(0,n.jsxs)("span",{className:"absolute right-3 bottom-3 text-xs text-stone-600",children:[m.length,"/500"]})]}),(0,n.jsx)("button",{onClick:p,disabled:!m.trim()||a||e.active&&!h,className:" px-6 py-3 rounded-lg font-bold bg-gradient-to-r from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 text-white shadow-lg shadow-amber-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 ",children:a?(0,n.jsx)(o.E.span,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"inline-block",children:"⏳"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"⚡"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Send"})]})})]}),a&&(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("span",{className:"text-amber-500 text-sm animate-pulse font-serif",children:"\uD83C\uDFB2 The Dungeon Master weaves your fate..."})})]})}function S(){let{character:e,combat:t,connected:a,setConnected:d,addMessage:m,messages:u,setIsLoading:x}=(0,r.gT)(),[h,b]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!e)return;console.log("[GameScreen] Mounted for",e.name,"initialized:",p);let t=(0,i.hb)();(null==t?void 0:t.connected)?(d(!0),console.log("[GameScreen] Requesting game state..."),t.emit("game:requestState"),p||m({id:(0,l.Ox)(),timestamp:Date.now(),type:"system",content:"⚔️ ".concat(e.name," the ").concat(e.race," ").concat(e.class," descends into the dungeon...")})):(console.log("[GameScreen] Socket not connected, connecting..."),(0,i.zp)().then(()=>{let t=(0,i.hb)();(null==t?void 0:t.connected)&&(d(!0),console.log("[GameScreen] Reconnected, re-emitting game:init"),t.emit("game:init",{name:e.name,race:e.race,class:e.class,spriteSheet:window.__playerSpriteSheet}))}))},[e,p,d,m]),(0,s.useEffect)(()=>{let e=()=>{console.log("[GameScreen] game:state event received"),x(!1),g(!0)};return window.addEventListener("game:state",e),()=>window.removeEventListener("game:state",e)},[x]),(0,n.jsxs)("div",{className:"h-screen w-screen flex flex-col md:flex-row overflow-hidden bg-black",children:[(0,n.jsxs)("div",{className:"md:hidden flex items-center justify-between p-3 bg-stone-900/90 border-b border-amber-900/30 backdrop-blur",children:[(0,n.jsx)("button",{onClick:()=>b(!h),className:"px-3 py-1.5 rounded bg-stone-800 border border-stone-700 text-stone-300 text-sm",children:h?"✕":"\uD83D\uDC64"}),(0,n.jsx)("div",{className:"text-amber-500 font-serif",children:null==e?void 0:e.name}),(0,n.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(a?"bg-emerald-500":"bg-red-500")})]}),(0,n.jsx)("aside",{className:"hidden md:flex w-64 flex-col bg-stone-900/95 border-r border-amber-900/30",children:(0,n.jsx)(N,{})}),(0,n.jsx)(c.M,{children:h&&(0,n.jsx)(o.E.aside,{initial:{x:-280},animate:{x:0},exit:{x:-280},className:"absolute left-0 top-14 bottom-0 w-64 z-50 bg-stone-900/98 border-r border-amber-900/30 md:hidden",children:(0,n.jsx)(N,{})})}),(0,n.jsxs)("main",{className:"flex-1 flex flex-col min-h-0 relative bg-black",children:[(0,n.jsx)(v,{}),t.active&&(0,n.jsx)("div",{className:"absolute top-0 left-0 right-0 p-4 z-10",children:(0,n.jsx)(w,{})})]}),(0,n.jsxs)("aside",{className:"h-[40vh] md:h-auto md:w-96 flex flex-col bg-stone-900/95 border-t md:border-t-0 md:border-l border-amber-900/30",children:[(0,n.jsx)("div",{className:"flex-1 overflow-hidden min-h-0",children:(0,n.jsx)(j,{})}),(0,n.jsx)(E,{})]})]})}function k(){let{screen:e}=(0,r.gT)();return(0,n.jsxs)("main",{className:"h-screen w-screen overflow-hidden bg-dungeon-gradient",children:["lobby"===e&&(0,n.jsx)(u,{}),"character-creation"===e&&(0,n.jsx)(p,{}),"game"===e&&(0,n.jsx)(S,{})]})}},6933:function(e,t,a){"use strict";a.d(t,{hb:function(){return s},zp:function(){return i}});var n=a(5040);let r=null;function s(){return function(){let e=window.__dungeonSocket||r;if(e)return e.connected,e;let t="https://allowed-beta-declaration-response.trycloudflare.com";console.log("[Socket] Creating socket to",t);let a=(0,n.io)(t,{autoConnect:!0,reconnection:!0,reconnectionAttempts:100,reconnectionDelay:500,reconnectionDelayMax:3e3,timeout:3e4,transports:["websocket","polling"]});return window.__dungeonSocket=a,r=a,window.__socketListeners=window.__socketListeners||[],a.on("connect",()=>{var e;console.log("[Socket] Connected, id:",a.id),null===(e=window.__socketListeners)||void 0===e||e.forEach(e=>e(!0))}),a.on("disconnect",e=>{var t;console.log("[Socket] Disconnected:",e),null===(t=window.__socketListeners)||void 0===t||t.forEach(e=>e(!1))}),a.on("connect_error",e=>{console.error("[Socket] Error:",e.message)}),a}()}function i(){return new Promise((e,t)=>{let a=s();if(!a){t(Error("Socket not available"));return}if(a.connected){console.log("[Socket] Already connected, id:",a.id),e();return}let n=setTimeout(()=>{console.log("[Socket] Connection timeout, resolving anyway"),e()},5e3),r=()=>{clearTimeout(n),a.off("connect",r),a.off("connect_error",i),console.log("[Socket] Connected successfully, id:",a.id),e()},i=t=>{clearTimeout(n),a.off("connect",r),a.off("connect_error",i),console.error("[Socket] Connection failed:",t.message),e()};a.once("connect",r),a.once("connect_error",i),console.log("[Socket] Connecting..."),a.connected||a.connect()})}},9354:function(e,t,a){"use strict";function n(){return Math.random().toString(36).substring(2,11)}function r(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t="";for(let a=0;a<6;a++)t+=e[Math.floor(Math.random()*e.length)];return t}function s(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function i(e){return Math.floor((e-10)/2)}function l(e){return e>=0?"+".concat(e):"".concat(e)}function o(e,t){return Math.max(0,Math.min(100,e/t*100))}a.d(t,{$V:function(){return r},G4:function(){return i},Ox:function(){return n},QO:function(){return o},i$:function(){return s},vd:function(){return l}})},9997:function(e,t,a){"use strict";a.d(t,{Ae:function(){return o},Ei:function(){return i},GG:function(){return l},gT:function(){return s}});var n=a(9099);let r={active:!1,turn:0,initiative:[],currentTurnId:null,log:[]},s=(0,n.Ue)(e=>({screen:"lobby",setScreen:t=>e({screen:t}),playerId:null,playerName:"",setPlayerName:t=>e({playerName:t}),character:null,setCharacter:t=>e({character:t}),campaign:null,setCampaign:t=>e({campaign:t}),campaignCode:"",setCampaignCode:t=>e({campaignCode:t}),messages:[],addMessage:t=>e(e=>({messages:[...e.messages,t].slice(-100)})),clearMessages:()=>e({messages:[]}),combat:r,setCombat:t=>e({combat:t}),addCombatLog:t=>e(e=>({combat:{...e.combat,log:[...e.combat.log,t].slice(-50)}})),scene:null,setScene:t=>e({scene:t}),connected:!1,setConnected:t=>e({connected:t}),isLoading:!1,setIsLoading:t=>e({isLoading:t})})),i=["STR","DEX","CON","INT","WIS","CHA"],l={warrior:{name:"Warrior",description:"Master of martial combat",primaryStat:"STR"},mage:{name:"Mage",description:"Wielder of arcane magic",primaryStat:"INT"},rogue:{name:"Rogue",description:"Shadow and stealth expert",primaryStat:"DEX"},cleric:{name:"Cleric",description:"Divine healer and protector",primaryStat:"WIS"},ranger:{name:"Ranger",description:"Wilderness tracker and hunter",primaryStat:"DEX"},paladin:{name:"Paladin",description:"Holy warrior of justice",primaryStat:"CHA"}},o={human:{name:"Human",bonus:{STR:1,DEX:1,CON:1,INT:1,WIS:1,CHA:1}},elf:{name:"Elf",bonus:{DEX:2,INT:1}},dwarf:{name:"Dwarf",bonus:{CON:2,STR:1}},halfling:{name:"Halfling",bonus:{DEX:2,CHA:1}},dragonborn:{name:"Dragonborn",bonus:{STR:2,CHA:1}},tiefling:{name:"Tiefling",bonus:{CHA:2,INT:1}}}}},function(e){e.O(0,[55,43,971,23,744],function(){return e(e.s=7285)}),_N_E=e.O()}]);