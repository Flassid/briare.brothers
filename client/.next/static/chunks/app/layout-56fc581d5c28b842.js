(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7879:function(e,n,o){Promise.resolve().then(o.t.bind(o,3054,23)),Promise.resolve().then(o.bind(o,3605))},3605:function(e,n,o){"use strict";o.d(n,{SocketProvider:function(){return s}});var t=o(7437),r=o(2265),i=o(6933),c=o(9997),a=o(9354);function s(e){let{children:n}=e,o=(0,r.useRef)(!1),{setConnected:s,addMessage:d,setIsLoading:l}=(0,c.gT)();return(0,r.useEffect)(()=>{if(o.current){console.log("[SocketProvider] Already initialized, skipping");return}o.current=!0,console.log("[SocketProvider] *** INITIALIZING SOCKET ***"),(async()=>{try{await (0,i.zp)();let e=(0,i.hb)();e.on("dm:narrate",e=>{console.log("[SocketProvider] DM narrate received"),l(!1),d({id:(0,a.Ox)(),timestamp:e.timestamp||Date.now(),type:"dm",content:e.content})}),e.on("game:state",e=>{var n;console.log("[SocketProvider] game:state received, tiles:",null==e?void 0:null===(n=e.tiles)||void 0===n?void 0:n.length),l(!1),window.dispatchEvent(new CustomEvent("game:state",{detail:e}))}),e.on("backstory:chunk",e=>{window.dispatchEvent(new CustomEvent("backstory:chunk",{detail:e}))}),e.on("backstory:complete",()=>{window.dispatchEvent(new CustomEvent("backstory:complete"))}),e.on("spritesheet:ready",e=>{console.log("[SocketProvider] Sprite ready:",e.type),window.dispatchEvent(new CustomEvent("spritesheet:ready",{detail:e}))}),e.on("generation:status",e=>{window.dispatchEvent(new CustomEvent("generation:status",{detail:e}))}),e.on("generation:progress",e=>{window.dispatchEvent(new CustomEvent("generation:progress",{detail:e}))}),e.on("generation:error",e=>{window.dispatchEvent(new CustomEvent("generation:error",{detail:e}))}),e.on("dungeon:pregenerated",()=>{console.log("[SocketProvider] Dungeon pre-generated"),window.dispatchEvent(new CustomEvent("dungeon:pregenerated"))}),e.on("room:image:ready",e=>{console.log("[SocketProvider] Room image ready:",e.roomType),window.dispatchEvent(new CustomEvent("room:image:ready",{detail:e}))}),e.on("player:anim",e=>{console.log("[SocketProvider] Player anim:",e.anim),window.dispatchEvent(new CustomEvent("player:anim",{detail:e}))}),e.on("player:moved",e=>{window.dispatchEvent(new CustomEvent("player:moved",{detail:e}))}),e.on("entity:anim",e=>{window.dispatchEvent(new CustomEvent("entity:anim",{detail:e}))}),e.on("room:change",e=>{window.dispatchEvent(new CustomEvent("room:change",{detail:e}))}),e.on("connect",()=>{console.log("[SocketProvider] Socket connected"),s(!0)}),e.on("disconnect",e=>{console.log("[SocketProvider] Socket disconnected:",e),s(!1)}),console.log("[SocketProvider] Socket ready, id:",e.id)}catch(e){console.error("[SocketProvider] Init error:",e)}})()},[s,d,l]),(0,t.jsx)(t.Fragment,{children:n})}},6933:function(e,n,o){"use strict";o.d(n,{hb:function(){return i},zp:function(){return c}});var t=o(5040);let r=null;function i(){return function(){let e=window.__dungeonSocket||r;if(e)return e.connected,e;let n="https://allowed-beta-declaration-response.trycloudflare.com";console.log("[Socket] Creating socket to",n);let o=(0,t.io)(n,{autoConnect:!0,reconnection:!0,reconnectionAttempts:100,reconnectionDelay:500,reconnectionDelayMax:3e3,timeout:3e4,transports:["websocket","polling"]});return window.__dungeonSocket=o,r=o,window.__socketListeners=window.__socketListeners||[],o.on("connect",()=>{var e;console.log("[Socket] Connected, id:",o.id),null===(e=window.__socketListeners)||void 0===e||e.forEach(e=>e(!0))}),o.on("disconnect",e=>{var n;console.log("[Socket] Disconnected:",e),null===(n=window.__socketListeners)||void 0===n||n.forEach(e=>e(!1))}),o.on("connect_error",e=>{console.error("[Socket] Error:",e.message)}),o}()}function c(){return new Promise((e,n)=>{let o=i();if(!o){n(Error("Socket not available"));return}if(o.connected){console.log("[Socket] Already connected, id:",o.id),e();return}let t=setTimeout(()=>{console.log("[Socket] Connection timeout, resolving anyway"),e()},5e3),r=()=>{clearTimeout(t),o.off("connect",r),o.off("connect_error",c),console.log("[Socket] Connected successfully, id:",o.id),e()},c=n=>{clearTimeout(t),o.off("connect",r),o.off("connect_error",c),console.error("[Socket] Connection failed:",n.message),e()};o.once("connect",r),o.once("connect_error",c),console.log("[Socket] Connecting..."),o.connected||o.connect()})}},9354:function(e,n,o){"use strict";function t(){return Math.random().toString(36).substring(2,11)}function r(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",n="";for(let o=0;o<6;o++)n+=e[Math.floor(Math.random()*e.length)];return n}function i(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function c(e){return Math.floor((e-10)/2)}function a(e){return e>=0?"+".concat(e):"".concat(e)}function s(e,n){return Math.max(0,Math.min(100,e/n*100))}o.d(n,{$V:function(){return r},G4:function(){return c},Ox:function(){return t},QO:function(){return s},i$:function(){return i},vd:function(){return a}})},9997:function(e,n,o){"use strict";o.d(n,{Ae:function(){return s},Ei:function(){return c},GG:function(){return a},gT:function(){return i}});var t=o(9099);let r={active:!1,turn:0,initiative:[],currentTurnId:null,log:[]},i=(0,t.Ue)(e=>({screen:"lobby",setScreen:n=>e({screen:n}),playerId:null,playerName:"",setPlayerName:n=>e({playerName:n}),character:null,setCharacter:n=>e({character:n}),campaign:null,setCampaign:n=>e({campaign:n}),campaignCode:"",setCampaignCode:n=>e({campaignCode:n}),messages:[],addMessage:n=>e(e=>({messages:[...e.messages,n].slice(-100)})),clearMessages:()=>e({messages:[]}),combat:r,setCombat:n=>e({combat:n}),addCombatLog:n=>e(e=>({combat:{...e.combat,log:[...e.combat.log,n].slice(-50)}})),scene:null,setScene:n=>e({scene:n}),connected:!1,setConnected:n=>e({connected:n}),isLoading:!1,setIsLoading:n=>e({isLoading:n})})),c=["STR","DEX","CON","INT","WIS","CHA"],a={warrior:{name:"Warrior",description:"Master of martial combat",primaryStat:"STR"},mage:{name:"Mage",description:"Wielder of arcane magic",primaryStat:"INT"},rogue:{name:"Rogue",description:"Shadow and stealth expert",primaryStat:"DEX"},cleric:{name:"Cleric",description:"Divine healer and protector",primaryStat:"WIS"},ranger:{name:"Ranger",description:"Wilderness tracker and hunter",primaryStat:"DEX"},paladin:{name:"Paladin",description:"Holy warrior of justice",primaryStat:"CHA"}},s={human:{name:"Human",bonus:{STR:1,DEX:1,CON:1,INT:1,WIS:1,CHA:1}},elf:{name:"Elf",bonus:{DEX:2,INT:1}},dwarf:{name:"Dwarf",bonus:{CON:2,STR:1}},halfling:{name:"Halfling",bonus:{DEX:2,CHA:1}},dragonborn:{name:"Dragonborn",bonus:{STR:2,CHA:1}},tiefling:{name:"Tiefling",bonus:{CHA:2,INT:1}}}},3054:function(){}},function(e){e.O(0,[141,55,971,23,744],function(){return e(e.s=7879)}),_N_E=e.O()}]);